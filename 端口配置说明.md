# 🔧 端口配置说明

## 📋 当前端口配置

由于80端口经常被其他服务占用，本游戏已更新默认端口配置：

| 服务类型 | 原端口 | 新端口 | 说明 |
|---------|--------|--------|------|
| HTTP服务 | 80 | **3000** | 游戏主页、API接口 |
| WebSocket | 8080 | **8080** | 联机对战通信（保持不变） |

## 🌐 访问地址

部署完成后，请使用以下地址访问：

- **🎮 游戏主页**: http://您的服务器IP:3000
- **📊 状态监控**: http://您的服务器IP:3000/status.html  
- **💚 健康检查**: http://您的服务器IP:3000/health

## 🔥 防火墙配置

⚠️ **重要**：必须在1Panel防火墙中开放以下端口：

1. **端口3000** - TCP协议，允许策略（HTTP服务）
2. **端口8080** - TCP协议，允许策略（WebSocket）

### 1Panel防火墙设置步骤：
1. 登录1Panel管理面板
2. 进入「安全」→「防火墙」
3. 点击「添加规则」
4. 添加端口3000和8080，协议选择TCP，策略选择允许

## 🚨 端口冲突解决

如果3000或8080端口仍被占用：

### 🔧 方法1：自动检测工具（推荐）
```bash
./check_ports.sh
```
此工具会自动：
- 检测可用端口
- 更新配置文件
- 可选择立即重新部署

### 🔧 方法2：手动修改
```bash
# 编辑配置文件
nano docker-compose.yml

# 修改端口映射，例如改为8000端口：
# "8000:80" 替换 "3000:80"

# 重新部署
docker-compose up -d --force-recreate
```

### 🔧 方法3：查看详细指南
参考完整的端口修改指南：[`端口修改指南.md`](./端口修改指南.md)

## ❓ 常见问题

### Q: 为什么不用80端口？
A: 80端口经常被以下服务占用：
- 1Panel自带的Web服务
- Nginx/Apache等Web服务器
- 其他Web应用

### Q: 可以改回80端口吗？
A: 可以，但需要先停止占用80端口的服务，然后修改配置。

### Q: 防火墙端口忘记开放怎么办？
A: 运行检查工具会提醒您：`./1panel-check.sh`

### Q: 如何查看当前端口配置？
A: 运行以下命令：
```bash
grep -n "ports:" -A 3 docker-compose.yml
```

## 🛠️ 相关工具

| 工具 | 用途 | 命令 |
|------|------|------|
| 端口检测 | 自动找到可用端口 | `./check_ports.sh` |
| 环境检查 | 检查部署状态 | `./1panel-check.sh` |
| 重新部署 | 重新启动服务 | `./deploy.sh -p` |
| 查看日志 | 排查问题 | `docker logs cannon-game-app` |

---

**🎉 完成配置后，享受您的炮与兵棋游戏！**

访问地址：http://您的服务器IP:3000 